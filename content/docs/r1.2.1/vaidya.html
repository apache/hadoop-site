<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.9">
<meta name="Forrest-skin-name" content="pelt">
<title>Vaidya Guide</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="images/favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="https://www.apache.org/">Apache</a> &gt; <a href="https://hadoop.apache.org/">Hadoop</a> &gt; <a href="https://hadoop.apache.org/core/">Core</a><script src="skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="https://hadoop.apache.org/"><img class="logoImage" alt="Hadoop" src="images/hadoop-logo.jpg" title="Apache Hadoop"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href="https://hadoop.apache.org/core/"><img class="logoImage" alt="Hadoop" src="images/hadoop-logo-2.gif" title="Scalable Computing Platform"></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="hadoop.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="25" name="q" id="query" type="text" value="Search the site with google">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="https://hadoop.apache.org/core/">Project</a>
</li>
<li>
<a class="unselected" href="https://wiki.apache.org/hadoop">Wiki</a>
</li>
<li class="current">
<a class="selected" href="index.html">Hadoop 1.2.1 Documentation</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">

             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_1.1', 'skin/')" id="menu_1.1Title" class="menutitle">Getting Started</div>
<div id="menu_1.1" class="menuitemgroup">
<div class="menuitem">
<a href="index.html">Overview</a>
</div>
<div class="menuitem">
<a href="single_node_setup.html">Single Node Setup</a>
</div>
<div class="menuitem">
<a href="cluster_setup.html">Cluster Setup</a>
</div>
<div class="menuitem">
<a href="cli_minicluster.html">CLI MiniCluster</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.2', 'skin/')" id="menu_1.2Title" class="menutitle">Guides</div>
<div id="menu_1.2" class="menuitemgroup">
<div class="menuitem">
<a href="HttpAuthentication.html">Authentication for Hadoop HTTP web-consoles</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.3', 'skin/')" id="menu_selected_1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">MapReduce</div>
<div id="menu_selected_1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="mapred_tutorial.html">MapReduce Tutorial</a>
</div>
<div class="menuitem">
<a href="streaming.html">Hadoop Streaming</a>
</div>
<div class="menuitem">
<a href="commands_manual.html">Hadoop Commands</a>
</div>
<div class="menuitem">
<a href="distcp.html">DistCp</a>
</div>
<div class="menuitem">
<a href="distcp2.html">DistCp Version 2</a>
</div>
<div class="menupage">
<div class="menupagetitle">Vaidya</div>
</div>
<div class="menuitem">
<a href="hadoop_archives.html">Hadoop Archives</a>
</div>
<div class="menuitem">
<a href="gridmix.html">Gridmix</a>
</div>
<div class="menuitem">
<a href="rumen.html">Rumen</a>
</div>
<div class="menuitem">
<a href="capacity_scheduler.html">Capacity Scheduler</a>
</div>
<div class="menuitem">
<a href="fair_scheduler.html">Fair Scheduler</a>
</div>
<div class="menuitem">
<a href="hod_scheduler.html">Hod Scheduler</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.4', 'skin/')" id="menu_1.4Title" class="menutitle">HDFS</div>
<div id="menu_1.4" class="menuitemgroup">
<div class="menuitem">
<a href="hdfs_user_guide.html">HDFS Users </a>
</div>
<div class="menuitem">
<a href="hdfs_design.html">HDFS Architecture</a>
</div>
<div class="menuitem">
<a href="hdfs_permissions_guide.html">Permissions</a>
</div>
<div class="menuitem">
<a href="hdfs_quota_admin_guide.html">Quotas</a>
</div>
<div class="menuitem">
<a href="SLG_user_guide.html">Synthetic Load Generator</a>
</div>
<div class="menuitem">
<a href="hdfs_imageviewer.html">Offline Image Viewer</a>
</div>
<div class="menuitem">
<a href="hftp.html">HFTP</a>
</div>
<div class="menuitem">
<a href="webhdfs.html">WebHDFS REST API</a>
</div>
<div class="menuitem">
<a href="libhdfs.html">C API libhdfs</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.5', 'skin/')" id="menu_1.5Title" class="menutitle">Common</div>
<div id="menu_1.5" class="menuitemgroup">
<div class="menuitem">
<a href="deployment_layout.html">Deployment Layout</a>
</div>
<div class="menuitem">
<a href="file_system_shell.html">File System Shell</a>
</div>
<div class="menuitem">
<a href="service_level_auth.html">Service Level Authorization</a>
</div>
<div class="menuitem">
<a href="native_libraries.html">Native Libraries</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.6', 'skin/')" id="menu_1.6Title" class="menutitle">Miscellaneous</div>
<div id="menu_1.6" class="menuitemgroup">
<div class="menuitem">
<a href="Secure_Impersonation.html">Secure Impersonation</a>
</div>
<div class="menuitem">
<a href="api/index.html">API Docs</a>
</div>
<div class="menuitem">
<a href="jdiff/changes.html">API Changes</a>
</div>
<div class="menuitem">
<a href="https://wiki.apache.org/hadoop/">Wiki</a>
</div>
<div class="menuitem">
<a href="https://wiki.apache.org/hadoop/FAQ">FAQ</a>
</div>
<div class="menuitem">
<a href="releasenotes.html">Release Notes</a>
</div>
<div class="menuitem">
<a href="changes.html">Change Log</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="vaidya.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Vaidya Guide</h1>
<div id="front-matter">
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Purpose">Purpose</a>
</li>
<li>
<a href="#Prerequisites">Prerequisites</a>
</li>
<li>
<a href="#Overview">Overview</a>
</li>
<li>
<a href="#Terminology">Terminology</a>
</li>
<li>
<a href="#How+to+Execute+the+Hadoop+Vaidya+Tool">How to Execute the Hadoop Vaidya Tool</a>
</li>
<li>
<a href="#How+to+Write+and+Execute+your+own+Tests">How to Write and Execute your own Tests</a>
</li>
</ul>
</div>
</div>
  
    
<a name="Purpose"></a>
<h2 class="h3">Purpose</h2>
<div class="section">
<p>This document describes various user-facing facets of Hadoop Vaidya, a performance diagnostic tool for map/reduce jobs. It
         describes how to execute a default set of rules against your map/reduce job counters and
         how to write and execute new rules to detect specific performance problems. 
      </p>
<p>A few sample test rules are provided with the tool with the objective of growing the rules database over the time. 
         You are welcome to contribute new rules for everyone's benefit; to do so, follow the 
         <a href="https://wiki.apache.org/hadoop/HowToContribute">How to Contribute</a> procedure
         specified on Apache Hadoop website.
      </p>
</div>
    
    
<a name="Prerequisites"></a>
<h2 class="h3">Prerequisites</h2>
<div class="section">
<p>Ensure that Hadoop is installed and configured. More details:</p>
<ul>
        
<li>
          Make sure HADOOP_HOME environment variable is set.
        </li>
        
<li>
          Make sure Java is installed and configured as a part of the Hadoop installation.
        </li>
      
</ul>
</div>
    
    
<a name="Overview"></a>
<h2 class="h3">Overview</h2>
<div class="section">
<p>Hadoop Vaidya (Vaidya in Sanskrit language means "one who knows", or "a physician") 
	    is a rule based performance diagnostic tool for 
        MapReduce jobs. It performs a post execution analysis of map/reduce 
        job by parsing and collecting execution statistics through job history 
        and job configuration files. It runs a set of predefined tests/rules 
        against job execution statistics to diagnose various performance problems. 
        Each test rule detects a specific performance problem with the MapReduce job and provides 
        a targeted advice to the user. This tool generates an XML report based on 
        the evaluation results of individual test rules.
      </p>
</div>
  
    
<a name="Terminology"></a>
<h2 class="h3">Terminology</h2>
<div class="section">
<p> This section describes main concepts and terminology involved with Hadoop Vaidya,</p>
<ul>
			
<li> 
<em>PostExPerformanceDiagnoser</em>: This class extends the base Diagnoser class and acts as a driver for post execution performance analysis of MapReduce Jobs. 
                       It detects performance inefficiencies by executing a set of performance diagnosis rules against the job execution statistics.</li>
			
<li> 
<em>Job Statistics</em>: This includes the job configuration information (job.xml) and various counters logged by MapReduce job as a part of the job history log
		           file. The counters are parsed and collected into the Job Statistics data structures, which contains global job level aggregate counters and 
			     a set of counters for each Map and Reduce task.</li>
			
<li> 
<em>Diagnostic Test/Rule</em>: This is a program logic that detects the inefficiency of M/R job based on the job statistics. The
				 description of the Test is specified as an XML element (DiagnosticTest) in a test description file e.g. 
				 default tests description file, <em>$HADOOP_HOME/contrib/vaidya/conf/postex_diagnosis_tests.xml</em>. The actual logic is coded as
				 a java class and referenced in the DiagnosticTest XML element. </li>
		
</ul>
<p></p>
<p>Following section describes the <em>DiagnosticTest</em> XML element in a diagnostic test description file </p>
<ul>
			
<li> 
<em>DiagnosticTest{Title}</em>: Specifies a short name/description of the test.</li>
			
<li> 
<em>DiagnosticTest{ClassName}</em>: Specifies fully qualified class name that implements the test logic.</li>
			
<li> 
<em>DiagnosticTest{Description}</em>: Specifies a full description of the test rule.</li>
			
<li> 
<em>DiagnosticTest{Importance}</em>: Specifies a declarative value for overall importance of the test rule. (Values: High, Medium, Low)</li>
			
<li> 
<em>DiagnosticTest{SuccessThreshod}</em>: This is a threshold value specified by test case writer such that if impact level of the test case
				 is lesser, then test is declared as PASSED (or NEGATIVE). The impact level is calculated and returned
				 by individual test's evaluate function, specifying the degree of problem job has with respect to the condition being evaluated.</li>
			
<li> 
<em>DiagnosticTest{Prescription}</em>: This is a targeted advice written by the test case adviser for the user to follow when test is not PASSED. </li>
			
<li> 
<em>DiagonsticTest{InputElement}</em>: This is a test specific input that test writer has to optionally provide. This will be supplied to individual test case
                       class so that test writer can use it within test case. This is typically a test configuration information such that test writer need not change the
                       Java code for test case but rather can configure the test case using these input values. </li>
		
</ul>
<p></p>
<p>Following section describes the performance analysis report generated by the tool in XML format</p>
<ul>
			
<li> 
<em>PostExPerformanceDiagnosticReport</em>: This is a document (root) element from the XML report generated by the tool. </li>
			
<li> 
<em>TestReportElement</em>: This is a XML report element from the test report document, one for each individual test specified in test description
				 file </li>  
			
<li> 
<em>TestReportElement{TestTitle}</em>: Will be included from DiagnosticTest{Title} </li>
			
<li> 
<em>TestReportElement{TestDescription}</em>: Will be included from DiagnosticTest{Description} </li>
			
<li> 
<em>TestReportElement{TestImportance}</em>: Will be included from DiagnosticTest{Importance} </li>
			
<li> 
<em>TestReportElement{TestSeverity}</em>: This is a product of Test Impact level and Test Importance. It indicates overall severity of the test.</li>
			
<li> 
<em>TestReportElement{ReferenceDetails}</em>: This is a test specific runtime information provided by test case to support the test result and severity. Typically
				 Test writer should print the test impact level in this section. </li>
			
<li> 
<em>TestReportElement{TestResults}</em>: This is boolean outcome of the test based on the SuccessThreshold specified by test writer in the DiagnosticTest description. The 
				 test PASSED(NEGATIVE) indicates no problem vs. FAILED (POSITIVE) indicates a potential problem with the job for given test case. </li>
			
<li> 
<em>TestReportElement{TestPrescription}</em>: This will be included from DiagnosticTest{Prescription}, unless test case writer overrides it in the test case class through getPrescription()
				 method </li>
		
</ul>
</div>
	
	
<a name="How+to+Execute+the+Hadoop+Vaidya+Tool"></a>
<h2 class="h3">How to Execute the Hadoop Vaidya Tool</h2>
<div class="section">
<p>Script to execute Hadoop Vaidya is in <span class="codefrag">$HADOOP_HOME/contrib/vaidya/bin/</span> directory.
		   It comes with a default set of rules defined in file: 
           <span class="codefrag">$HADOOP_HOME/contrib/vaidya/conf/postex_diagnosis_tests.xml</span> 
</p>
<ul>
			
<li>Make sure HADOOP_HOME environment variable is set and Java is installed and configured.</li>
			
<li>Execute the Hadoop Vaidya script with -help (or without any arguments) to get the command line help. e.g. 
                       <span class="codefrag">=&gt;sh $HADOOP_HOME/contrib/vaidya/bin/vaidya.sh -help</span>
</li>
			
<li>User needs to 
				 supply job's configuration file (<span class="codefrag">-jobconf job_conf.xml</span>), job history log file (<span class="codefrag">-joblog job_history_log_file</span>), and optionally the test description
				 file (<span class="codefrag">-testconf postex_diagonostic_tests.xml</span>). If test description file is not specified then the default one is picked up from the Hadoop Vaidya Jar (<span class="codefrag">$HADOOP_HOME/contrib/vaidya/hadoop-{version}-vaidya.jar</span>).
				 This default test description file is also available at following location for users to make a local copy, modify and add new test rules: 
			     <span class="codefrag">$HADOOP_HOME/contrib/vaidya/conf/postex_diagnostic_tests.xml</span>
</li>
			
<li> Use <span class="codefrag">-report report_file</span> option to store the xml report into specified report_file. </li>  
		 
</ul>
</div>
	
    
<a name="How+to+Write+and+Execute+your+own+Tests"></a>
<h2 class="h3">How to Write and Execute your own Tests</h2>
<div class="section">
<p>Writing and executing your own test rules is not very hard. You can take a look at Hadoop Vaidya source code for existing set of tests. 
		   The source code is at this <a href="http://svn.apache.org/viewvc/hadoop/core/trunk/src/contrib/vaidya/src/java/org/apache/hadoop/vaidya/">hadoop svn repository location</a>. The default set of tests are under <span class="codefrag">"postexdiagnosis/tests/"</span> folder.</p>
<ul>
		  
<li>Writing a test class for your new test case should extend the <span class="codefrag">org.apache.hadoop.vaidya.DiagnosticTest</span> class and 
		       it should override following three methods from the base class, 
              <ul> 
				
<li> evaluate() </li>
				
<li> getPrescription() </li> 
 				
<li> getReferenceDetails() </li> 
              
</ul>
          
</li>
		  
<li>Make a local copy of the <span class="codefrag">$HADOOP_HOME/contrib/vaidya/conf/postex_diagnostic_tests.xml</span> file or create a new test description XML file.</li>
		  
<li>Add the test description element for your new test case to this test description file.</li>
		  
<li>Compile your new test class (or multiple classes), archive them into a Jar file and add it to the CLASSPATH e.g. (<span class="codefrag">export CLASSPATH=$CLASSPATH:newtests.jar</span>)</li>
		  
<li>Execute the Hadoop Vaidya script with the job configuration, job history log and reference to newly created test description file using <em>--testconf</em> option. 
		  <span class="codefrag">=&gt;sh $HADOOP_HOME/contrib/vaidya/bin/vaidya.sh -joblog job_history_log_file -jobconf job.xml -testconf new_test_description_file -report report.xml</span>
</li>
		
</ul>
</div>
	
    
<p> 
</p>
    
<p> 
</p>
    
<p>
      
<em>Java and JNI are trademarks or registered trademarks of 
      Sun Microsystems, Inc. in the United States and other countries.</em>
    
</p>
    
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2008 <a href="https://www.apache.org/licenses/">The Apache Software Foundation.</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
