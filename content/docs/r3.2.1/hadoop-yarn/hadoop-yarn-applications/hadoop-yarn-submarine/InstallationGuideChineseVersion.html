<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at 2019-09-10
 | Rendered using Apache Maven Stylus Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Apache Hadoop 3.2.1 &#x2013; Submarine 安装说明</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta name="Date-Revision-yyyymmdd" content="20190910" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://hadoop.apache.org/" id="bannerLeft">
                                        <img src="http://hadoop.apache.org/images/hadoop-logo.jpg" alt="" />
                </a>
                              <a href="http://www.apache.org/" id="bannerRight">
                                        <img src="http://www.apache.org/images/asf_logo_wide.png" alt="" />
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                   <div class="xleft">
                          <a href="http://www.apache.org/" class="externalLink">Apache</a>
        &gt;
                  <a href="http://hadoop.apache.org/" class="externalLink">Hadoop</a>
        &gt;
                  <a href="../../index.html">Apache Hadoop YARN</a>
        &gt;
                  <a href="../index.html">Apache Hadoop YARN Applications</a>
        &gt;
                  <a href="index.html">Apache Hadoop 3.2.1</a>
        &gt;
        Submarine 安装说明
        </div>
            <div class="xright">            <a href="http://wiki.apache.org/hadoop" class="externalLink">Wiki</a>
            |
                <a href="https://gitbox.apache.org/repos/asf/hadoop.git" class="externalLink">git</a>
            |
                <a href="http://hadoop.apache.org/" class="externalLink">Apache Hadoop</a>
              
                                   &nbsp;| Last Published: 2019-09-10
              &nbsp;| Version: 3.2.1
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                   <h5>General</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SingleCluster.html">Single Node Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ClusterSetup.html">Cluster Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CommandsManual.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/FileSystemShell.html">FileSystem Shell</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Compatibility.html">Compatibility Specification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DownstreamDev.html">Downstream Developer's Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/AdminCompatibilityGuide.html">Admin Compatibility Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/InterfaceClassification.html">Interface Classification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/filesystem/index.html">FileSystem Specification</a>
            </li>
          </ul>
                       <h5>Common</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CLIMiniCluster.html">CLI Mini Cluster</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/NativeLibraries.html">Native Libraries</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Superusers.html">Proxy User</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/RackAwareness.html">Rack Awareness</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SecureMode.html">Secure Mode</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ServiceLevelAuth.html">Service Level Authorization</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/HttpAuthentication.html">HTTP Authentication</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CredentialProviderAPI.html">Credential Provider API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-kms/index.html">Hadoop KMS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Tracing.html">Tracing</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellGuide.html">Unix Shell Guide</a>
            </li>
          </ul>
                       <h5>HDFS</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDesign.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUserGuide.html">User Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html">NameNode HA With QJM</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithNFS.html">NameNode HA With NFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/Federation.html">Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ViewFs.html">ViewFs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsSnapshots.html">Snapshots</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsEditsViewer.html">Edits Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsImageViewer.html">Image Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html">Permissions and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsQuotaAdminGuide.html">Quotas and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/LibHdfs.html">libhdfs (C API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/WebHDFS.html">WebHDFS (REST API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-hdfs-httpfs/index.html">HttpFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ShortCircuitLocalReads.html">Short Circuit Local Reads</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/CentralizedCacheManagement.html">Centralized Cache Management</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsNfsGateway.html">NFS Gateway</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsRollingUpgrade.html">Rolling Upgrade</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ExtendedAttributes.html">Extended Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/TransparentEncryption.html">Transparent Encryption</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsMultihoming.html">Multihoming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ArchivalStorage.html">Storage Policies</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/MemoryStorage.html">Memory Storage Support</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/SLGUserGuide.html">Synthetic Load Generator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSErasureCoding.html">Erasure Coding</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSDiskbalancer.html">Disk Balancer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUpgradeDomain.html">Upgrade Domain</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDataNodeAdminGuide.html">DataNode Admin</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/HDFSRouterFederation.html">Router Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsProvidedStorage.html">Provided Storage</a>
            </li>
          </ul>
                       <h5>MapReduce</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html">Tutorial</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduce_Compatibility_Hadoop1_Hadoop2.html">Compatibility with 1.x</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/EncryptedShuffle.html">Encrypted Shuffle</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/PluggableShuffleAndPluggableSort.html">Pluggable Shuffle/Sort</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/DistributedCacheDeploy.html">Distributed Cache Deploy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/SharedCacheSupport.html">Support for YARN Shared Cache</a>
            </li>
          </ul>
                       <h5>MapReduce REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredAppMasterRest.html">MR Application Master</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-hs/HistoryServerRest.html">MR History Server</a>
            </li>
          </ul>
                       <h5>YARN</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YARN.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/CapacityScheduler.html">Capacity Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/FairScheduler.html">Fair Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRestart.html">ResourceManager Restart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html">ResourceManager HA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceModel.html">Resource Model</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeLabel.html">Node Labels</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeAttributes.html">Node Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebApplicationProxy.html">Web Application Proxy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html">Timeline Service V.2</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WritingYarnApplications.html">Writing YARN Applications</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnApplicationSecurity.html">YARN Application Security</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManager.html">NodeManager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/DockerContainers.html">Running Applications in Docker Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerCgroups.html">Using CGroups</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SecureContainer.html">Secure Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/registry/index.html">Registry</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ReservationSystem.html">Reservation System</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html">Graceful Decommission</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/OpportunisticContainers.html">Opportunistic Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/Federation.html">YARN Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SharedCache.html">Shared Cache</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingGpus.html">Using GPU</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingFPGA.html">Using FPGA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/PlacementConstraints.html">Placement Constraints</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnUI2.html">YARN UI2</a>
            </li>
          </ul>
                       <h5>YARN REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebServicesIntro.html">Introduction</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRest.html">Resource Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerRest.html">Node Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html#Timeline_Server_REST_API_v1">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html#Timeline_Service_v.2_REST_API">Timeline Service V.2</a>
            </li>
          </ul>
                       <h5>YARN Service</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Overview.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/QuickStart.html">QuickStart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Concepts.html">Concepts</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/YarnServiceAPI.html">Yarn Service API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/ServiceDiscovery.html">Service Discovery</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/SystemServices.html">System Services</a>
            </li>
          </ul>
                       <h5>Submarine</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-submarine/Index.html">Index</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-submarine/QuickStart.html">QuickStart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-submarine/Examples.html">Examples</a>
            </li>
          </ul>
                       <h5>Hadoop Compatible File Systems</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-aliyun/tools/hadoop-aliyun/index.html">Aliyun OSS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-aws/tools/hadoop-aws/index.html">Amazon S3</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure/index.html">Azure Blob Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure-datalake/index.html">Azure Data Lake Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-openstack/index.html">OpenStack Swift</a>
            </li>
          </ul>
                       <h5>Auth</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-auth/index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Examples.html">Examples</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Configuration.html">Configuration</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/BuildingIt.html">Building</a>
            </li>
          </ul>
                       <h5>Tools</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-streaming/HadoopStreaming.html">Hadoop Streaming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archives/HadoopArchives.html">Hadoop Archives</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archive-logs/HadoopArchiveLogs.html">Hadoop Archive Logs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-distcp/DistCp.html">DistCp</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-gridmix/GridMix.html">GridMix</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-rumen/Rumen.html">Rumen</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-resourceestimator/ResourceEstimator.html">Resource Estimator Service</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-sls/SchedulerLoadSimulator.html">Scheduler Load Simulator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Benchmarking.html">Hadoop Benchmarking</a>
            </li>
          </ul>
                       <h5>Reference</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/release/index.html">Changelog and Release Notes</a>
            </li>
                  <li class="none">
                  <a href="../../../api/index.html">Java API docs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellAPI.html">Unix Shell API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Metrics.html">Metrics</a>
            </li>
          </ul>
                       <h5>Configuration</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/core-default.xml">core-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/hdfs-default.xml">hdfs-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/hdfs-rbf-default.xml">hdfs-rbf-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/mapred-default.xml">mapred-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-common/yarn-default.xml">yarn-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DeprecatedProperties.html">Deprecated Properties</a>
            </li>
          </ul>
                                 <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
          <img alt="Built by Maven" src="./images/logos/maven-feather.png"/>
        </a>
                       
                               </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!---
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
-->
<h1>Submarine &#x5b89;&#x88c5;&#x8bf4;&#x660e;</h1>
<div class="section">
<h2><a name="Prerequisites"></a>Prerequisites</h2>
<div class="section">
<h3><a name="a.E6.93.8D.E4.BD.9C.E7.B3.BB.E7.BB.9F"></a>&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;</h3>
<p>&#x6211;&#x4eec;&#x4f7f;&#x7528;&#x7684;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x7248;&#x672c;&#x662f; centos-release-7-3.1611.el7.centos.x86_64, &#x5185;&#x6838;&#x7248;&#x672c;&#x662f; 3.10.0-514.el7.x86_64 &#xff0c;&#x5e94;&#x8be5;&#x662f;&#x6700;&#x4f4e;&#x7248;&#x672c;&#x4e86;&#x3002;</p>
<table border="0" class="bodyTable">
<thead>

<tr class="a">
<th> Enviroment </th>
<th> Verion </th></tr>
</thead><tbody>

<tr class="b">
<td> Operating System </td>
<td> centos-release-7-3.1611.el7.centos.x86_64 </td></tr>
<tr class="a">
<td> Kernal </td>
<td> 3.10.0-514.el7.x86_64 </td></tr>
</tbody>
</table></div>
<div class="section">
<h3><a name="User_.26_Group"></a>User &amp; Group</h3>
<p>&#x5982;&#x679c;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x4e2d;&#x6ca1;&#x6709;&#x8fd9;&#x4e9b;&#x7528;&#x6237;&#x7ec4;&#x548c;&#x7528;&#x6237;&#xff0c;&#x5fc5;&#x987b;&#x6dfb;&#x52a0;&#x3002;&#x4e00;&#x90e8;&#x5206;&#x7528;&#x6237;&#x662f; hadoop &#x8fd0;&#x884c;&#x9700;&#x8981;&#xff0c;&#x4e00;&#x90e8;&#x5206;&#x7528;&#x6237;&#x662f; docker &#x8fd0;&#x884c;&#x9700;&#x8981;&#x3002;</p>

<div>
<div>
<pre class="source">adduser hdfs
adduser mapred
adduser yarn
addgroup hadoop
usermod -aG hdfs,hadoop hdfs
usermod -aG mapred,hadoop mapred
usermod -aG yarn,hadoop yarn
usermod -aG hdfs,hadoop hadoop
groupadd docker
usermod -aG docker yarn
usermod -aG docker hadoop
</pre></div></div>
</div>
<div class="section">
<h3><a name="GCC_.E7.89.88.E6.9C.AC"></a>GCC &#x7248;&#x672c;</h3>

<div>
<div>
<pre class="source">gcc --version
gcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-11)
# &#x5982;&#x679c;&#x6ca1;&#x6709;&#x5b89;&#x88c5;&#x8bf7;&#x6267;&#x884c;&#x4ee5;&#x4e0b;&#x547d;&#x4ee4;&#x8fdb;&#x884c;&#x5b89;&#x88c5;
yum install gcc make g++
</pre></div></div>
</div>
<div class="section">
<h3><a name="Kernel_header_.26_devel"></a>Kernel header &amp; devel</h3>

<div>
<div>
<pre class="source"># &#x65b9;&#x6cd5;&#x4e00;&#xff1a;
yum install kernel-devel-$(uname -r) kernel-headers-$(uname -r)
# &#x65b9;&#x6cd5;&#x4e8c;&#xff1a;
wget http://vault.centos.org/7.3.1611/os/x86_64/Packages/kernel-headers-3.10.0-514.el7.x86_64.rpm
rpm -ivh kernel-headers-3.10.0-514.el7.x86_64.rpm
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E6.A3.80.E6.9F.A5_GPU_.E7.89.88.E6.9C.AC"></a>&#x68c0;&#x67e5; GPU &#x7248;&#x672c;</h3>

<div>
<div>
<pre class="source">lspci | grep -i nvidia

# &#x5982;&#x679c;&#x4ec0;&#x4e48;&#x90fd;&#x6ca1;&#x8f93;&#x51fa;&#xff0c;&#x5c31;&#x8bf4;&#x660e;&#x663e;&#x5361;&#x4e0d;&#x5bf9;&#xff0c;&#x4ee5;&#x4e0b;&#x662f;&#x6211;&#x7684;&#x8f93;&#x51fa;&#xff1a;
# 04:00.0 3D controller: NVIDIA Corporation Device 1b38 (rev a1)
# 82:00.0 3D controller: NVIDIA Corporation Device 1b38 (rev a1)
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E5.AE.89.E8.A3.85_nvidia_.E9.A9.B1.E5.8A.A8"></a>&#x5b89;&#x88c5; nvidia &#x9a71;&#x52a8;</h3>
<p>&#x5b89;&#x88c5;nvidia driver/cuda&#x8981;&#x786e;&#x4fdd;&#x5df2;&#x5b89;&#x88c5;&#x7684;nvidia driver/cuda&#x5df2;&#x88ab;&#x6e05;&#x7406;</p>

<div>
<div>
<pre class="source"># &#x5378;&#x8f7d;cuda&#xff1a;
sudo /usr/local/cuda-10.0/bin/uninstall_cuda_10.0.pl

# &#x5378;&#x8f7d;nvidia-driver&#xff1a;
sudo /usr/bin/nvidia-uninstall
</pre></div></div>

<p>&#x5b89;&#x88c5;nvidia-detect&#xff0c;&#x7528;&#x4e8e;&#x68c0;&#x67e5;&#x663e;&#x5361;&#x7248;&#x672c;</p>

<div>
<div>
<pre class="source">yum install nvidia-detect
# &#x8fd0;&#x884c;&#x547d;&#x4ee4; nvidia-detect -v &#x8fd4;&#x56de;&#x7ed3;&#x679c;&#xff1a;
nvidia-detect -v
Probing for supported NVIDIA devices...
[10de:13bb] NVIDIA Corporation GM107GL [Quadro K620]
This device requires the current 390.87 NVIDIA driver kmod-nvidia
[8086:1912] Intel Corporation HD Graphics 530
An Intel display controller was also detected
</pre></div></div>

<p>&#x6ce8;&#x610f;&#x8fd9;&#x91cc;&#x7684;&#x4fe1;&#x606f; [Quadro K620] &#x548c;390.87&#x3002; &#x4e0b;&#x8f7d; <a class="externalLink" href="https://www.nvidia.com/object/linux-amd64-display-archive.html">NVIDIA-Linux-x86_64-390.87.run</a></p>
<p>&#x5b89;&#x88c5;&#x524d;&#x7684;&#x4e00;&#x7cfb;&#x5217;&#x51c6;&#x5907;&#x5de5;&#x4f5c;</p>

<div>
<div>
<pre class="source"># &#x82e5;&#x7cfb;&#x7edf;&#x5f88;&#x4e45;&#x6ca1;&#x66f4;&#x65b0;&#xff0c;&#x8fd9;&#x53e5;&#x53ef;&#x80fd;&#x8017;&#x65f6;&#x8f83;&#x957f;
yum -y update
yum -y install kernel-devel

yum -y install epel-release
yum -y install dkms

# &#x7981;&#x7528;nouveau
vim /etc/default/grub  #&#x5728;&#x201c;GRUB_CMDLINE_LINUX&#x201d;&#x4e2d;&#x6dfb;&#x52a0;&#x5185;&#x5bb9; rd.driver.blacklist=nouveau nouveau.modeset=0
grub2-mkconfig -o /boot/grub2/grub.cfg # &#x751f;&#x6210;&#x914d;&#x7f6e;
vim /etc/modprobe.d/blacklist.conf # &#x6253;&#x5f00;&#xff08;&#x65b0;&#x5efa;&#xff09;&#x6587;&#x4ef6;&#xff0c;&#x6dfb;&#x52a0;&#x5185;&#x5bb9;blacklist nouveau

mv /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r)-nouveau.img
dracut /boot/initramfs-$(uname -r).img $(uname -r)   # &#x66f4;&#x65b0;&#x914d;&#x7f6e;&#xff0c;&#x5e76;&#x91cd;&#x542f;
reboot
</pre></div></div>

<p>&#x5f00;&#x673a;&#x540e;&#x786e;&#x8ba4;&#x662f;&#x5426;&#x7981;&#x7528;</p>

<div>
<div>
<pre class="source">lsmod | grep nouveau  # &#x5e94;&#x8be5;&#x8fd4;&#x56de;&#x7a7a;

# &#x5f00;&#x59cb;&#x5b89;&#x88c5;
sh NVIDIA-Linux-x86_64-390.87.run
</pre></div></div>

<p>&#x5b89;&#x88c5;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x4f1a;&#x9047;&#x5230;&#x4e00;&#x4e9b;&#x9009;&#x9879;&#xff1a;</p>

<div>
<div>
<pre class="source">Install NVIDIA's 32-bit compatibility libraries (Yes)
centos Install NVIDIA's 32-bit compatibility libraries (Yes)
Would you like to run the nvidia-xconfig utility to automatically update your X configuration file... (NO)
</pre></div></div>

<p>&#x6700;&#x540e;&#x67e5;&#x770b; nvidia gpu &#x72b6;&#x6001;</p>

<div>
<div>
<pre class="source">nvidia-smi
</pre></div></div>

<p>reference&#xff1a; <a class="externalLink" href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html">https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html</a></p></div>
<div class="section">
<h3><a name="a.E5.AE.89.E8.A3.85_Docker"></a>&#x5b89;&#x88c5; Docker</h3>

<div>
<div>
<pre class="source">yum -y update
yum -y install yum-utils
yum-config-manager --add-repo https://yum.dockerproject.org/repo/main/centos/7
yum -y update

# &#x663e;&#x793a; available &#x7684;&#x5b89;&#x88c5;&#x5305;
yum search --showduplicates docker-engine

# &#x5b89;&#x88c5; 1.12.5 &#x7248;&#x672c; docker
yum -y --nogpgcheck install docker-engine-1.12.5*
systemctl start docker

chown hadoop:netease /var/run/docker.sock
chown hadoop:netease /usr/bin/docker
</pre></div></div>

<p>Reference&#xff1a;<a class="externalLink" href="https://docs.docker.com/cs-engine/1.12/">https://docs.docker.com/cs-engine/1.12/</a></p></div>
<div class="section">
<h3><a name="a.E9.85.8D.E7.BD.AE_Docker"></a>&#x914d;&#x7f6e; Docker</h3>
<p>&#x5728; <tt>/etc/docker/</tt> &#x76ee;&#x5f55;&#x4e0b;&#xff0c;&#x521b;&#x5efa;<tt>daemon.json</tt>&#x6587;&#x4ef6;, &#x6dfb;&#x52a0;&#x4ee5;&#x4e0b;&#x914d;&#x7f6e;&#xff0c;&#x53d8;&#x91cf;&#x5982;image_registry_ip, etcd_host_ip, localhost_ip, yarn_dns_registry_host_ip, dns_host_ip&#x9700;&#x8981;&#x6839;&#x636e;&#x5177;&#x4f53;&#x73af;&#x5883;&#xff0c;&#x8fdb;&#x884c;&#x4fee;&#x6539;</p>

<div>
<div>
<pre class="source">{
    &quot;insecure-registries&quot;: [&quot;${image_registry_ip}:5000&quot;],
    &quot;cluster-store&quot;:&quot;etcd://${etcd_host_ip1}:2379,${etcd_host_ip2}:2379,${etcd_host_ip3}:2379&quot;,
    &quot;cluster-advertise&quot;:&quot;{localhost_ip}:2375&quot;,
    &quot;dns&quot;: [&quot;${yarn_dns_registry_host_ip}&quot;, &quot;${dns_host_ip1}&quot;],
    &quot;hosts&quot;: [&quot;tcp://{localhost_ip}:2375&quot;, &quot;unix:///var/run/docker.sock&quot;]
}
</pre></div></div>

<p>&#x91cd;&#x542f; docker daemon&#xff1a;</p>

<div>
<div>
<pre class="source">sudo systemctl restart docker
</pre></div></div>
</div>
<div class="section">
<h3><a name="Docker_EE_version"></a>Docker EE version</h3>

<div>
<div>
<pre class="source">$ docker version

Client:
 Version:      1.12.5
 API version:  1.24
 Go version:   go1.6.4
 Git commit:   7392c3b
 Built:        Fri Dec 16 02:23:59 2016
 OS/Arch:      linux/amd64

Server:
 Version:      1.12.5
 API version:  1.24
 Go version:   go1.6.4
 Git commit:   7392c3b
 Built:        Fri Dec 16 02:23:59 2016
 OS/Arch:      linux/amd64
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E5.AE.89.E8.A3.85_nvidia-docker"></a>&#x5b89;&#x88c5; nvidia-docker</h3>
<p>Hadoop-3.2 &#x7684; submarine &#x4f7f;&#x7528;&#x7684;&#x662f; 1.0 &#x7248;&#x672c;&#x7684; nvidia-docker</p>

<div>
<div>
<pre class="source">wget -P /tmp https://github.com/NVIDIA/nvidia-docker/releases/download/v1.0.1/nvidia-docker-1.0.1-1.x86_64.rpm
sudo rpm -i /tmp/nvidia-docker*.rpm
# &#x542f;&#x52a8; nvidia-docker
sudo systemctl start nvidia-docker

# &#x67e5;&#x770b; nvidia-docker &#x72b6;&#x6001;&#xff1a;
systemctl status nvidia-docker

# &#x67e5;&#x770b; nvidia-docker &#x65e5;&#x5fd7;&#xff1a;
journalctl -u nvidia-docker

# &#x67e5;&#x770b; nvidia-docker-plugin &#x662f;&#x5426;&#x6b63;&#x5e38;
curl http://localhost:3476/v1.0/docker/cli
</pre></div></div>

<p>&#x5728; <tt>/var/lib/nvidia-docker/volumes/nvidia_driver/</tt> &#x8def;&#x5f84;&#x4e0b;&#xff0c;&#x6839;&#x636e; <tt>nvidia-driver</tt> &#x7684;&#x7248;&#x672c;&#x521b;&#x5efa;&#x6587;&#x4ef6;&#x5939;&#xff1a;</p>

<div>
<div>
<pre class="source">mkdir /var/lib/nvidia-docker/volumes/nvidia_driver/390.87
# &#x5176;&#x4e2d;390.87&#x662f;nvidia driver&#x7684;&#x7248;&#x672c;&#x53f7;

mkdir /var/lib/nvidia-docker/volumes/nvidia_driver/390.87/bin
mkdir /var/lib/nvidia-docker/volumes/nvidia_driver/390.87/lib64

cp /usr/bin/nvidia* /var/lib/nvidia-docker/volumes/nvidia_driver/390.87/bin
cp /usr/lib64/libcuda* /var/lib/nvidia-docker/volumes/nvidia_driver/390.87/lib64
cp /usr/lib64/libnvidia* /var/lib/nvidia-docker/volumes/nvidia_driver/390.87/lib64

# Test nvidia-smi
nvidia-docker run --rm nvidia/cuda:9.0-devel nvidia-smi
</pre></div></div>

<p>&#x6d4b;&#x8bd5; docker, nvidia-docker, nvidia-driver &#x5b89;&#x88c5;</p>

<div>
<div>
<pre class="source"># &#x6d4b;&#x8bd5;&#x4e00;
nvidia-docker run -rm nvidia/cuda nvidia-smi
</pre></div></div>

<div>
<div>
<pre class="source"># &#x6d4b;&#x8bd5;&#x4e8c;
nvidia-docker run -it tensorflow/tensorflow:1.9.0-gpu bash
# &#x5728;docker&#x4e2d;&#x6267;&#x884c;
python
import tensorflow as tf
tf.test.is_gpu_available()
</pre></div></div>

<p>&#x5378;&#x8f7d; nvidia-docker 1.0 &#x7684;&#x65b9;&#x6cd5;&#xff1a; <a class="externalLink" href="https://github.com/nvidia/nvidia-docker/wiki/Installation-(version-2.0)">https://github.com/nvidia/nvidia-docker/wiki/Installation-(version-2.0)</a></p>
<p>reference: <a class="externalLink" href="https://github.com/NVIDIA/nvidia-docker/tree/1.0">https://github.com/NVIDIA/nvidia-docker/tree/1.0</a></p></div>
<div class="section">
<h3><a name="Tensorflow_Image"></a>Tensorflow Image</h3>
<p>CUDNN &#x548c; CUDA &#x5176;&#x5b9e;&#x4e0d;&#x9700;&#x8981;&#x5728;&#x7269;&#x7406;&#x673a;&#x4e0a;&#x5b89;&#x88c5;&#xff0c;&#x56e0;&#x4e3a; Sumbmarine &#x4e2d;&#x63d0;&#x4f9b;&#x4e86;&#x5df2;&#x7ecf;&#x5305;&#x542b;&#x4e86;CUDNN &#x548c; CUDA &#x7684;&#x955c;&#x50cf;&#x6587;&#x4ef6;&#xff0c;&#x57fa;&#x7840;&#x7684;Dockfile&#x53ef;&#x53c2;&#x89c1;WriteDockerfile.md</p>
<p>&#x4e0a;&#x8ff0;images&#x65e0;&#x6cd5;&#x652f;&#x6301;kerberos&#x73af;&#x5883;&#xff0c;&#x5982;&#x679c;&#x9700;&#x8981;kerberos&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x5982;&#x4e0b;Dockfile</p>

<div>
<div>
<pre class="source">FROM nvidia/cuda:9.0-cudnn7-devel-ubuntu16.04

# Pick up some TF dependencies
RUN apt-get update &amp;&amp; apt-get install -y --allow-downgrades --no-install-recommends \
        build-essential \
        cuda-command-line-tools-9-0 \
        cuda-cublas-9-0 \
        cuda-cufft-9-0 \
        cuda-curand-9-0 \
        cuda-cusolver-9-0 \
        cuda-cusparse-9-0 \
        curl \
        libcudnn7=7.0.5.15-1+cuda9.0 \
        libfreetype6-dev \
        libpng12-dev \
        libzmq3-dev \
        pkg-config \
        python \
        python-dev \
        rsync \
        software-properties-common \
        unzip \
        &amp;&amp; \
    apt-get clean &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

RUN export DEBIAN_FRONTEND=noninteractive &amp;&amp; apt-get update &amp;&amp; apt-get install -yq krb5-user libpam-krb5 &amp;&amp; apt-get clean

RUN curl -O https://bootstrap.pypa.io/get-pip.py &amp;&amp; \
    python get-pip.py &amp;&amp; \
    rm get-pip.py

RUN pip --no-cache-dir install \
        Pillow \
        h5py \
        ipykernel \
        jupyter \
        matplotlib \
        numpy \
        pandas \
        scipy \
        sklearn \
        &amp;&amp; \
    python -m ipykernel.kernelspec

# Install TensorFlow GPU version.
RUN pip --no-cache-dir install \
    http://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.8.0-cp27-none-linux_x86_64.whl
RUN apt-get update &amp;&amp; apt-get install git -y

RUN apt-get update &amp;&amp; apt-get install -y openjdk-8-jdk wget
# &#x4e0b;&#x8f7d; hadoop-3.1.1.tar.gz
RUN wget http://mirrors.hust.edu.cn/apache/hadoop/common/hadoop-3.1.1/hadoop-3.1.1.tar.gz
RUN tar zxf hadoop-3.1.1.tar.gz
RUN mv hadoop-3.1.1 hadoop-3.1.0

# &#x4e0b;&#x8f7d;&#x652f;&#x6301;kerberos&#x7684;jdk&#x5b89;&#x88c5;&#x5305;
RUN wget -qO jdk8.tar.gz 'http://${kerberos_jdk_url}/jdk-8u152-linux-x64.tar.gz'
RUN tar xzf jdk8.tar.gz -C /opt
RUN mv /opt/jdk* /opt/java
RUN rm jdk8.tar.gz
RUN update-alternatives --install /usr/bin/java java /opt/java/bin/java 100
RUN update-alternatives --install /usr/bin/javac javac /opt/java/bin/javac 100

ENV JAVA_HOME /opt/java
ENV PATH $PATH:$JAVA_HOME/bin
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E6.B5.8B.E8.AF.95_TF_.E7.8E.AF.E5.A2.83"></a>&#x6d4b;&#x8bd5; TF &#x73af;&#x5883;</h3>
<p>&#x521b;&#x5efa;&#x597d; docker &#x955c;&#x50cf;&#x540e;&#xff0c;&#x9700;&#x8981;&#x5148;&#x624b;&#x52a8;&#x68c0;&#x67e5; TensorFlow &#x662f;&#x5426;&#x53ef;&#x4ee5;&#x6b63;&#x5e38;&#x4f7f;&#x7528;&#xff0c;&#x907f;&#x514d;&#x901a;&#x8fc7; YARN &#x8c03;&#x5ea6;&#x540e;&#x51fa;&#x73b0;&#x95ee;&#x9898;&#xff0c;&#x53ef;&#x4ee5;&#x6267;&#x884c;&#x4ee5;&#x4e0b;&#x547d;&#x4ee4;</p>

<div>
<div>
<pre class="source">$ docker run -it ${docker_image_name} /bin/bash
# &gt;&gt;&gt; &#x8fdb;&#x5165;&#x5bb9;&#x5668;
$ python
$ python &gt;&gt; import tensorflow as tf
$ python &gt;&gt; tf.__version__
</pre></div></div>

<p>&#x5982;&#x679c;&#x51fa;&#x73b0;&#x95ee;&#x9898;&#xff0c;&#x53ef;&#x4ee5;&#x6309;&#x7167;&#x4ee5;&#x4e0b;&#x8def;&#x5f84;&#x8fdb;&#x884c;&#x6392;&#x67e5;</p>
<ol style="list-style-type: decimal">

<li>&#x73af;&#x5883;&#x53d8;&#x91cf;&#x662f;&#x5426;&#x8bbe;&#x7f6e;&#x6b63;&#x786e;</li>
</ol>

<div>
<div>
<pre class="source">echo $LD_LIBRARY_PATH
/usr/local/cuda/extras/CUPTI/lib64:/usr/local/nvidia/lib:/usr/local/nvidia/lib64
</pre></div></div>

<ol style="list-style-type: decimal">

<li>libcuda.so.1,libcuda.so&#x662f;&#x5426;&#x5728;LD_LIBRARY_PATH&#x6307;&#x5b9a;&#x7684;&#x8def;&#x5f84;&#x4e2d;</li>
</ol>

<div>
<div>
<pre class="source">ls -l /usr/local/nvidia/lib64 | grep libcuda.so
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E5.AE.89.E8.A3.85_Etcd"></a>&#x5b89;&#x88c5; Etcd</h3>
<p>&#x8fd0;&#x884c; Submarine/install.sh &#x811a;&#x672c;&#xff0c;&#x5c31;&#x53ef;&#x4ee5;&#x5728;&#x6307;&#x5b9a;&#x670d;&#x52a1;&#x5668;&#x4e2d;&#x5b89;&#x88c5; Etcd &#x7ec4;&#x4ef6;&#x548c;&#x670d;&#x52a1;&#x81ea;&#x542f;&#x52a8;&#x811a;&#x672c;&#x3002;</p>

<div>
<div>
<pre class="source">$ ./Submarine/install.sh
# &#x901a;&#x8fc7;&#x5982;&#x4e0b;&#x547d;&#x4ee4;&#x67e5;&#x770b; Etcd &#x670d;&#x52a1;&#x72b6;&#x6001;
systemctl status Etcd.service
</pre></div></div>

<p>&#x68c0;&#x67e5; Etcd &#x670d;&#x52a1;&#x72b6;&#x6001;</p>

<div>
<div>
<pre class="source">$ etcdctl cluster-health
member 3adf2673436aa824 is healthy: got healthy result from http://${etcd_host_ip1}:2379
member 85ffe9aafb7745cc is healthy: got healthy result from http://${etcd_host_ip2}:2379
member b3d05464c356441a is healthy: got healthy result from http://${etcd_host_ip3}:2379
cluster is healthy

$ etcdctl member list
3adf2673436aa824: name=etcdnode3 peerURLs=http://${etcd_host_ip1}:2380 clientURLs=http://${etcd_host_ip1}:2379 isLeader=false
85ffe9aafb7745cc: name=etcdnode2 peerURLs=http://${etcd_host_ip2}:2380 clientURLs=http://${etcd_host_ip2}:2379 isLeader=false
b3d05464c356441a: name=etcdnode1 peerURLs=http://${etcd_host_ip3}:2380 clientURLs=http://${etcd_host_ip3}:2379 isLeader=true
</pre></div></div>

<p>&#x5176;&#x4e2d;&#xff0c;${etcd_host_ip*} &#x662f;etcd&#x670d;&#x52a1;&#x5668;&#x7684;ip</p></div>
<div class="section">
<h3><a name="a.E5.AE.89.E8.A3.85_Calico"></a>&#x5b89;&#x88c5; Calico</h3>
<p>&#x8fd0;&#x884c; Submarine/install.sh &#x811a;&#x672c;&#xff0c;&#x5c31;&#x53ef;&#x4ee5;&#x5728;&#x6307;&#x5b9a;&#x670d;&#x52a1;&#x5668;&#x4e2d;&#x5b89;&#x88c5; Calico &#x7ec4;&#x4ef6;&#x548c;&#x670d;&#x52a1;&#x81ea;&#x542f;&#x52a8;&#x811a;&#x672c;&#x3002;</p>

<div>
<div>
<pre class="source">systemctl start calico-node.service
systemctl status calico-node.service
</pre></div></div>

<div class="section">
<h4><a name="a.E6.A3.80.E6.9F.A5_Calico_.E7.BD.91.E7.BB.9C"></a>&#x68c0;&#x67e5; Calico &#x7f51;&#x7edc;</h4>

<div>
<div>
<pre class="source"># &#x6267;&#x884c;&#x5982;&#x4e0b;&#x547d;&#x4ee4;&#xff0c;&#x6ce8;&#x610f;&#xff1a;&#x4e0d;&#x4f1a;&#x663e;&#x793a;&#x672c;&#x670d;&#x52a1;&#x5668;&#x7684;&#x72b6;&#x6001;&#xff0c;&#x53ea;&#x663e;&#x793a;&#x5176;&#x4ed6;&#x7684;&#x670d;&#x52a1;&#x5668;&#x72b6;&#x6001;
$ calicoctl node status
Calico process is running.

IPv4 BGP status
+---------------+-------------------+-------+------------+-------------+
| PEER ADDRESS  |     PEER TYPE     | STATE |   SINCE    |    INFO     |
+---------------+-------------------+-------+------------+-------------+
| ${host_ip1} | node-to-node mesh | up    | 2018-09-21 | Established |
| ${host_ip2} | node-to-node mesh | up    | 2018-09-21 | Established |
| ${host_ip3} | node-to-node mesh | up    | 2018-09-21 | Established |
+---------------+-------------------+-------+------------+-------------+

IPv6 BGP status
No IPv6 peers found.
</pre></div></div>

<p>&#x521b;&#x5efa;docker container&#xff0c;&#x9a8c;&#x8bc1;calico&#x7f51;&#x7edc;</p>

<div>
<div>
<pre class="source">docker network create --driver calico --ipam-driver calico-ipam calico-network
docker run --net calico-network --name workload-A -tid busybox
docker run --net calico-network --name workload-B -tid busybox
docker exec workload-A ping workload-B
</pre></div></div>
</div></div></div>
<div class="section">
<h2><a name="a.E5.AE.89.E8.A3.85_Hadoop"></a>&#x5b89;&#x88c5; Hadoop</h2>
<div class="section">
<h3><a name="a.E7.BC.96.E8.AF.91_Hadoop"></a>&#x7f16;&#x8bd1; Hadoop</h3>

<div>
<div>
<pre class="source">mvn package -Pdist -DskipTests -Dtar
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E5.90.AF.E5.8A.A8_YARN.E6.9C.8D.E5.8A.A1"></a>&#x542f;&#x52a8; YARN&#x670d;&#x52a1;</h3>

<div>
<div>
<pre class="source">YARN_LOGFILE=resourcemanager.log ./sbin/yarn-daemon.sh start resourcemanager
YARN_LOGFILE=nodemanager.log ./sbin/yarn-daemon.sh start nodemanager
YARN_LOGFILE=timeline.log ./sbin/yarn-daemon.sh start timelineserver
YARN_LOGFILE=mr-historyserver.log ./sbin/mr-jobhistory-daemon.sh start historyserver
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E5.90.AF.E5.8A.A8_registery_dns_.E6.9C.8D.E5.8A.A1"></a>&#x542f;&#x52a8; registery dns &#x670d;&#x52a1;</h3>

<div>
<div>
<pre class="source">sudo YARN_LOGFILE=registrydns.log ./yarn-daemon.sh start registrydns
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E6.B5.8B.E8.AF.95_wordcount"></a>&#x6d4b;&#x8bd5; wordcount</h3>
<p>&#x901a;&#x8fc7;&#x6d4b;&#x8bd5;&#x6700;&#x7b80;&#x5355;&#x7684; wordcount &#xff0c;&#x68c0;&#x67e5; YARN &#x662f;&#x5426;&#x6b63;&#x786e;&#x5b89;&#x88c5;</p>

<div>
<div>
<pre class="source">./bin/hadoop jar /home/hadoop/hadoop-current/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.2.0-SNAPSHOT.jar wordcount /tmp/wordcount.txt /tmp/wordcount-output4
</pre></div></div>
</div></div>
<div class="section">
<h2><a name="a.E4.BD.BF.E7.94.A8CUP.E7.9A.84Tensorflow.E4.BB.BB.E5.8A.A1"></a>&#x4f7f;&#x7528;CUP&#x7684;Tensorflow&#x4efb;&#x52a1;</h2>
<div class="section">
<h3><a name="a.E5.8D.95.E6.9C.BA.E6.A8.A1.E5.BC.8F"></a>&#x5355;&#x673a;&#x6a21;&#x5f0f;</h3>
<div class="section">
<h4><a name="a.E6.B8.85.E7.90.86.E9.87.8D.E5.90.8D.E7.A8.8B.E5.BA.8F"></a>&#x6e05;&#x7406;&#x91cd;&#x540d;&#x7a0b;&#x5e8f;</h4>

<div>
<div>
<pre class="source"># &#x6bcf;&#x6b21;&#x63d0;&#x4ea4;&#x524d;&#x9700;&#x8981;&#x6267;&#x884c;&#xff1a;
./bin/yarn app -destroy standalone-tf
# &#x5e76;&#x5220;&#x9664;hdfs&#x8def;&#x5f84;&#xff1a;
./bin/hdfs dfs -rmr hdfs://${dfs_name_service}/tmp/cifar-10-jobdir
# &#x786e;&#x4fdd;&#x4e4b;&#x524d;&#x7684;&#x4efb;&#x52a1;&#x5df2;&#x7ecf;&#x7ed3;&#x675f;
</pre></div></div>

<p>&#x5176;&#x4e2d;&#xff0c;&#x53d8;&#x91cf;${dfs_name_service}&#x8bf7;&#x6839;&#x636e;&#x73af;&#x5883;&#xff0c;&#x7528;&#x4f60;&#x7684;hdfs name service&#x540d;&#x79f0;&#x66ff;&#x6362;</p></div>
<div class="section">
<h4><a name="a.E6.89.A7.E8.A1.8C.E5.8D.95.E6.9C.BA.E6.A8.A1.E5.BC.8F.E7.9A.84tensorflow.E4.BB.BB.E5.8A.A1"></a>&#x6267;&#x884c;&#x5355;&#x673a;&#x6a21;&#x5f0f;&#x7684;tensorflow&#x4efb;&#x52a1;</h4>

<div>
<div>
<pre class="source">./bin/yarn jar /home/hadoop/hadoop-current/share/hadoop/yarn/hadoop-yarn-submarine-3.2.0-SNAPSHOT.jar job run \
 --env DOCKER_JAVA_HOME=/opt/java \
 --env DOCKER_HADOOP_HDFS_HOME=/hadoop-3.1.0 --name standalone-tf \
 --docker_image dockerfile-cpu-tf1.8.0-with-models \
 --input_path hdfs://${dfs_name_service}/tmp/cifar-10-data \
 --checkpoint_path hdfs://${dfs_name_service}/user/hadoop/tf-checkpoint \
 --worker_resources memory=4G,vcores=2 --verbose \
 --worker_launch_cmd &quot;python /test/cifar10_estimator/cifar10_main.py --data-dir=hdfs://${dfs_name_service}/tmp/cifar-10-data --job-dir=hdfs://${dfs_name_service}/tmp/cifar-10-jobdir --train-steps=500 --eval-batch-size=16 --train-batch-size=16 --num-gpus=0&quot;
</pre></div></div>
</div></div>
<div class="section">
<h3><a name="a.E5.88.86.E5.B8.83.E5.BC.8F.E6.A8.A1.E5.BC.8F"></a>&#x5206;&#x5e03;&#x5f0f;&#x6a21;&#x5f0f;</h3>
<div class="section">
<h4><a name="a.E6.B8.85.E7.90.86.E9.87.8D.E5.90.8D.E7.A8.8B.E5.BA.8F"></a>&#x6e05;&#x7406;&#x91cd;&#x540d;&#x7a0b;&#x5e8f;</h4>

<div>
<div>
<pre class="source"># &#x6bcf;&#x6b21;&#x63d0;&#x4ea4;&#x524d;&#x9700;&#x8981;&#x6267;&#x884c;&#xff1a;
./bin/yarn app -destroy distributed-tf
# &#x5e76;&#x5220;&#x9664;hdfs&#x8def;&#x5f84;&#xff1a;
./bin/hdfs dfs -rmr hdfs://${dfs_name_service}/tmp/cifar-10-jobdir
# &#x786e;&#x4fdd;&#x4e4b;&#x524d;&#x7684;&#x4efb;&#x52a1;&#x5df2;&#x7ecf;&#x7ed3;&#x675f;
</pre></div></div>
</div>
<div class="section">
<h4><a name="a.E6.8F.90.E4.BA.A4.E5.88.86.E5.B8.83.E5.BC.8F.E6.A8.A1.E5.BC.8F_tensorflow_.E4.BB.BB.E5.8A.A1"></a>&#x63d0;&#x4ea4;&#x5206;&#x5e03;&#x5f0f;&#x6a21;&#x5f0f; tensorflow &#x4efb;&#x52a1;</h4>

<div>
<div>
<pre class="source">./bin/yarn jar /home/hadoop/hadoop-current/share/hadoop/yarn/hadoop-yarn-submarine-3.2.0-SNAPSHOT.jar job run \
 --env DOCKER_JAVA_HOME=/opt/java \
 --env DOCKER_HADOOP_HDFS_HOME=/hadoop-3.1.0 --name distributed-tf \
 --env YARN_CONTAINER_RUNTIME_DOCKER_CONTAINER_NETWORK=calico-network \
 --docker_image dockerfile-cpu-tf1.8.0-with-models \
 --input_path hdfs://${dfs_name_service}/tmp/cifar-10-data \
 --checkpoint_path hdfs://${dfs_name_service}/user/hadoop/tf-distributed-checkpoint \
 --worker_resources memory=4G,vcores=2 --verbose \
 --num_ps 1 \
 --ps_resources memory=4G,vcores=2 \
 --ps_launch_cmd &quot;python /test/cifar10_estimator/cifar10_main.py --data-dir=hdfs://${dfs_name_service}/tmp/cifar-10-data --job-dir=hdfs://${dfs_name_service}/tmp/cifar-10-jobdir --num-gpus=0&quot; \
 --num_workers 4 \
 --worker_launch_cmd &quot;python /test/cifar10_estimator/cifar10_main.py --data-dir=hdfs://${dfs_name_service}/tmp/cifar-10-data --job-dir=hdfs://${${dfs_name_service}}/tmp/cifar-10-jobdir --train-steps=500 --eval-batch-size=16 --train-batch-size=16 --sync --num-gpus=0&quot;
</pre></div></div>
</div></div></div>
<div class="section">
<h2><a name="a.E4.BD.BF.E7.94.A8GPU.E7.9A.84Tensorflow.E4.BB.BB.E5.8A.A1"></a>&#x4f7f;&#x7528;GPU&#x7684;Tensorflow&#x4efb;&#x52a1;</h2>
<div class="section">
<h3><a name="Resourcemanager.2C_Nodemanager_.E4.B8.AD.E6.B7.BB.E5.8A.A0GPU.E6.94.AF.E6.8C.81"></a>Resourcemanager, Nodemanager &#x4e2d;&#x6dfb;&#x52a0;GPU&#x652f;&#x6301;</h3>
<p>&#x5728; yarn &#x914d;&#x7f6e;&#x6587;&#x4ef6;&#x5939;(conf&#x6216;etc/hadoop)&#x4e2d;&#x521b;&#x5efa; resource-types.xml&#xff0c;&#x6dfb;&#x52a0;&#xff1a;</p>

<div>
<div>
<pre class="source">&lt;configuration&gt;
  &lt;property&gt;
    &lt;name&gt;yarn.resource-types&lt;/name&gt;
    &lt;value&gt;yarn.io/gpu&lt;/value&gt;
  &lt;/property&gt;
&lt;/configuration&gt;
</pre></div></div>
</div>
<div class="section">
<h3><a name="Resourcemanager_.E7.9A.84_GPU_.E9.85.8D.E7.BD.AE"></a>Resourcemanager &#x7684; GPU &#x914d;&#x7f6e;</h3>
<p>resourcemanager &#x4f7f;&#x7528;&#x7684; scheduler &#x5fc5;&#x987b;&#x662f; capacity scheduler&#xff0c;&#x5728; capacity-scheduler.xml &#x4e2d;&#x4fee;&#x6539;&#x5c5e;&#x6027;&#xff1a;</p>

<div>
<div>
<pre class="source">&lt;configuration&gt;
  &lt;property&gt;
    &lt;name&gt;yarn.scheduler.capacity.resource-calculator&lt;/name&gt;
    &lt;value&gt;org.apache.hadoop.yarn.util.resource.DominantResourceCalculator&lt;/value&gt;
  &lt;/property&gt;
&lt;/configuration&gt;
</pre></div></div>
</div>
<div class="section">
<h3><a name="Nodemanager_.E7.9A.84_GPU_.E9.85.8D.E7.BD.AE"></a>Nodemanager &#x7684; GPU &#x914d;&#x7f6e;</h3>
<p>&#x5728; nodemanager &#x7684; yarn-site.xml &#x4e2d;&#x6dfb;&#x52a0;&#x914d;&#x7f6e;&#xff1a;</p>

<div>
<div>
<pre class="source">&lt;configuration&gt;
  &lt;property&gt;
    &lt;name&gt;yarn.nodemanager.resource-plugins&lt;/name&gt;
    &lt;value&gt;yarn.io/gpu&lt;/value&gt;
  &lt;/property&gt;
&lt;/configuration&gt;
</pre></div></div>

<p>&#x5728; container-executor.cfg &#x4e2d;&#x6dfb;&#x52a0;&#x914d;&#x7f6e;&#xff1a;</p>

<div>
<div>
<pre class="source">[docker]
...
# &#x5728;[docker]&#x5df2;&#x6709;&#x914d;&#x7f6e;&#x4e2d;&#xff0c;&#x6dfb;&#x52a0;&#x4ee5;&#x4e0b;&#x5185;&#x5bb9;&#xff1a;
# /usr/bin/nvidia-docker&#x662f;nvidia-docker&#x8def;&#x5f84;
# nvidia_driver_375.26&#x7684;&#x7248;&#x672c;&#x53f7;375.26&#xff0c;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;nvidia-smi&#x67e5;&#x770b;
docker.allowed.volume-drivers=/usr/bin/nvidia-docker
docker.allowed.devices=/dev/nvidiactl,/dev/nvidia-uvm,/dev/nvidia-uvm-tools,/dev/nvidia1,/dev/nvidia0
docker.allowed.ro-mounts=nvidia_driver_375.26

[gpu]
module.enabled=true

[cgroups]
# /sys/fs/cgroup&#x662f;cgroup&#x7684;mount&#x8def;&#x5f84;
# /hadoop-yarn&#x662f;yarn&#x5728;cgroup&#x8def;&#x5f84;&#x4e0b;&#x9ed8;&#x8ba4;&#x521b;&#x5efa;&#x7684;path
root=/sys/fs/cgroup
yarn-hierarchy=/hadoop-yarn
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E6.8F.90.E4.BA.A4.E9.AA.8C.E8.AF.81"></a>&#x63d0;&#x4ea4;&#x9a8c;&#x8bc1;</h3>
<p>Distributed-shell + GPU + cgroup</p>

<div>
<div>
<pre class="source"> ./yarn jar /home/hadoop/hadoop-current/share/hadoop/yarn/hadoop-yarn-submarine-3.2.0-SNAPSHOT.jar job run \
 --env DOCKER_JAVA_HOME=/opt/java \
 --env DOCKER_HADOOP_HDFS_HOME=/hadoop-3.1.0 --name distributed-tf-gpu \
 --env YARN_CONTAINER_RUNTIME_DOCKER_CONTAINER_NETWORK=calico-network \
 --docker_image gpu-cuda9.0-tf1.8.0-with-models \
 --input_path hdfs://${dfs_name_service}/tmp/cifar-10-data \
 --checkpoint_path hdfs://${dfs_name_service}/user/hadoop/tf-distributed-checkpoint \
 --num_ps 0 \
 --ps_resources memory=4G,vcores=2,gpu=0 \
 --ps_launch_cmd &quot;python /test/cifar10_estimator/cifar10_main.py --data-dir=hdfs://${dfs_name_service}/tmp/cifar-10-data --job-dir=hdfs://${dfs_name_service}/tmp/cifar-10-jobdir --num-gpus=0&quot; \
 --worker_resources memory=4G,vcores=2,gpu=1 --verbose \
 --num_workers 1 \
 --worker_launch_cmd &quot;python /test/cifar10_estimator/cifar10_main.py --data-dir=hdfs://${dfs_name_service}/tmp/cifar-10-data --job-dir=hdfs://${dfs_name_service}/tmp/cifar-10-jobdir --train-steps=500 --eval-batch-size=16 --train-batch-size=16 --sync --num-gpus=1&quot;
</pre></div></div>
</div></div>
<div class="section">
<h2><a name="a.E9.97.AE.E9.A2.98"></a>&#x95ee;&#x9898;</h2>
<div class="section">
<h3><a name="a.E9.97.AE.E9.A2.98.E4.B8.80:_.E6.93.8D.E4.BD.9C.E7.B3.BB.E7.BB.9F.E9.87.8D.E5.90.AF.E5.AF.BC.E8.87.B4_nodemanager_.E5.90.AF.E5.8A.A8.E5.A4.B1.E8.B4.A5"></a>&#x95ee;&#x9898;&#x4e00;: &#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x91cd;&#x542f;&#x5bfc;&#x81f4; nodemanager &#x542f;&#x52a8;&#x5931;&#x8d25;</h3>

<div>
<div>
<pre class="source">2018-09-20 18:54:39,785 ERROR org.apache.hadoop.yarn.server.nodemanager.LinuxContainerExecutor: Failed to bootstrap configured resource subsystems!
org.apache.hadoop.yarn.server.nodemanager.containermanager.linux.resources.ResourceHandlerException: Unexpected: Cannot create yarn cgroup Subsystem:cpu Mount points:/proc/mounts User:yarn Path:/sys/fs/cgroup/cpu,cpuacct/hadoop-yarn
  at org.apache.hadoop.yarn.server.nodemanager.containermanager.linux.resources.CGroupsHandlerImpl.initializePreMountedCGroupController(CGroupsHandlerImpl.java:425)
  at org.apache.hadoop.yarn.server.nodemanager.containermanager.linux.resources.CGroupsHandlerImpl.initializeCGroupController(CGroupsHandlerImpl.java:377)
  at org.apache.hadoop.yarn.server.nodemanager.containermanager.linux.resources.CGroupsCpuResourceHandlerImpl.bootstrap(CGroupsCpuResourceHandlerImpl.java:98)
  at org.apache.hadoop.yarn.server.nodemanager.containermanager.linux.resources.CGroupsCpuResourceHandlerImpl.bootstrap(CGroupsCpuResourceHandlerImpl.java:87)
  at org.apache.hadoop.yarn.server.nodemanager.containermanager.linux.resources.ResourceHandlerChain.bootstrap(ResourceHandlerChain.java:58)
  at org.apache.hadoop.yarn.server.nodemanager.LinuxContainerExecutor.init(LinuxContainerExecutor.java:320)
  at org.apache.hadoop.yarn.server.nodemanager.NodeManager.serviceInit(NodeManager.java:389)
  at org.apache.hadoop.service.AbstractService.init(AbstractService.java:164)
  at org.apache.hadoop.yarn.server.nodemanager.NodeManager.initAndStartNodeManager(NodeManager.java:929)
  at org.apache.hadoop.yarn.server.nodemanager.NodeManager.main(NodeManager.java:997)
2018-09-20 18:54:39,789 INFO org.apache.hadoop.service.AbstractService: Service NodeManager failed in state INITED
</pre></div></div>

<p>&#x89e3;&#x51b3;&#x65b9;&#x6cd5;&#xff1a;&#x4f7f;&#x7528; <tt>root</tt> &#x8d26;&#x53f7;&#x7ed9; <tt>yarn</tt> &#x7528;&#x6237;&#x4fee;&#x6539; <tt>/sys/fs/cgroup/cpu,cpuacct</tt> &#x7684;&#x6743;&#x9650;</p>

<div>
<div>
<pre class="source">chown :yarn -R /sys/fs/cgroup/cpu,cpuacct
chmod g+rwx -R /sys/fs/cgroup/cpu,cpuacct
</pre></div></div>

<p>&#x5728;&#x652f;&#x6301;gpu&#x65f6;&#xff0c;&#x8fd8;&#x9700;cgroup devices&#x8def;&#x5f84;&#x6743;&#x9650;</p>

<div>
<div>
<pre class="source">chown :yarn -R /sys/fs/cgroup/devices
chmod g+rwx -R /sys/fs/cgroup/devices
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E9.97.AE.E9.A2.98.E4.BA.8C.EF.BC.9Acontainer-executor_.E6.9D.83.E9.99.90.E9.97.AE.E9.A2.98"></a>&#x95ee;&#x9898;&#x4e8c;&#xff1a;container-executor &#x6743;&#x9650;&#x95ee;&#x9898;</h3>

<div>
<div>
<pre class="source">2018-09-21 09:36:26,102 WARN org.apache.hadoop.yarn.server.nodemanager.containermanager.linux.privileged.PrivilegedOperationExecutor: IOException executing command:
java.io.IOException: Cannot run program &quot;/etc/yarn/sbin/Linux-amd64-64/container-executor&quot;: error=13, Permission denied
        at java.lang.ProcessBuilder.start(ProcessBuilder.java:1048)
        at org.apache.hadoop.util.Shell.runCommand(Shell.java:938)
        at org.apache.hadoop.util.Shell.run(Shell.java:901)
        at org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:1213)
</pre></div></div>

<p><tt>/etc/yarn/sbin/Linux-amd64-64/container-executor</tt> &#x8be5;&#x6587;&#x4ef6;&#x7684;&#x6743;&#x9650;&#x5e94;&#x4e3a;6050</p></div>
<div class="section">
<h3><a name="a.E9.97.AE.E9.A2.98.E4.B8.89.EF.BC.9A.E6.9F.A5.E7.9C.8B.E7.B3.BB.E7.BB.9F.E6.9C.8D.E5.8A.A1.E5.90.AF.E5.8A.A8.E6.97.A5.E5.BF.97"></a>&#x95ee;&#x9898;&#x4e09;&#xff1a;&#x67e5;&#x770b;&#x7cfb;&#x7edf;&#x670d;&#x52a1;&#x542f;&#x52a8;&#x65e5;&#x5fd7;</h3>

<div>
<div>
<pre class="source">journalctl -u docker
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E9.97.AE.E9.A2.98.E5.9B.9B.EF.BC.9ADocker_.E6.97.A0.E6.B3.95.E5.88.A0.E9.99.A4.E5.AE.B9.E5.99.A8.E7.9A.84.E9.97.AE.E9.A2.98_device_or_resource_busy"></a>&#x95ee;&#x9898;&#x56db;&#xff1a;Docker &#x65e0;&#x6cd5;&#x5220;&#x9664;&#x5bb9;&#x5668;&#x7684;&#x95ee;&#x9898; <tt>device or resource busy</tt></h3>

<div>
<div>
<pre class="source">$ docker rm 0bfafa146431
Error response from daemon: Unable to remove filesystem for 0bfafa146431771f6024dcb9775ef47f170edb2f1852f71916ba44209ca6120a: remove /app/docker/containers/0bfafa146431771f6024dcb9775ef47f170edb2f152f71916ba44209ca6120a/shm: device or resource busy
</pre></div></div>

<p>&#x7f16;&#x5199; <tt>find-busy-mnt.sh</tt> &#x811a;&#x672c;&#xff0c;&#x68c0;&#x67e5; <tt>device or resource busy</tt> &#x72b6;&#x6001;&#x7684;&#x5bb9;&#x5668;&#x6302;&#x8f7d;&#x6587;&#x4ef6;</p>

<div>
<div>
<pre class="source">#!/bin/bash

# A simple script to get information about mount points and pids and their
# mount namespaces.

if [ $# -ne 1 ];then
echo &quot;Usage: $0 &lt;devicemapper-device-id&gt;&quot;
exit 1
fi

ID=$1

MOUNTS=`find /proc/*/mounts | xargs grep $ID 2&gt;/dev/null`

[ -z &quot;$MOUNTS&quot; ] &amp;&amp;  echo &quot;No pids found&quot; &amp;&amp; exit 0

printf &quot;PID\tNAME\t\tMNTNS\n&quot;
echo &quot;$MOUNTS&quot; | while read LINE; do
PID=`echo $LINE | cut -d &quot;:&quot; -f1 | cut -d &quot;/&quot; -f3`
# Ignore self and thread-self
if [ &quot;$PID&quot; == &quot;self&quot; ] || [ &quot;$PID&quot; == &quot;thread-self&quot; ]; then
  continue
fi
NAME=`ps -q $PID -o comm=`
MNTNS=`readlink /proc/$PID/ns/mnt`
printf &quot;%s\t%s\t\t%s\n&quot; &quot;$PID&quot; &quot;$NAME&quot; &quot;$MNTNS&quot;
done
</pre></div></div>

<p>&#x67e5;&#x627e;&#x5360;&#x7528;&#x76ee;&#x5f55;&#x7684;&#x8fdb;&#x7a0b;</p>

<div>
<div>
<pre class="source">$ chmod +x find-busy-mnt.sh
./find-busy-mnt.sh 0bfafa146431771f6024dcb9775ef47f170edb2f152f71916ba44209ca6120a
# PID   NAME            MNTNS
# 5007  ntpd            mnt:[4026533598]
$ kill -9 5007
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E9.97.AE.E9.A2.98.E4.BA.94.EF.BC.9A.E5.91.BD.E4.BB.A4sudo_nvidia-docker_run_.E6.8A.A5.E9.94.99"></a>&#x95ee;&#x9898;&#x4e94;&#xff1a;&#x547d;&#x4ee4;sudo nvidia-docker run &#x62a5;&#x9519;</h3>

<div>
<div>
<pre class="source">docker: Error response from daemon: create nvidia_driver_361.42: VolumeDriver.Create: internal error, check logs for details.
See 'docker run --help'.
</pre></div></div>

<p>&#x89e3;&#x51b3;&#x65b9;&#x6cd5;&#xff1a;</p>

<div>
<div>
<pre class="source">#&#x67e5;&#x770b;nvidia-docker&#x72b6;&#x6001;&#xff0c;&#x662f;&#x4e0d;&#x662f;&#x542f;&#x52a8;&#x6709;&#x95ee;&#x9898;&#xff0c;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;
$ systemctl status nvidia-docker
$ journalctl -n -u nvidia-docker
#&#x91cd;&#x542f;&#x4e0b;nvidia-docker
systemctl stop nvidia-docker
systemctl start nvidia-docker
</pre></div></div>
</div>
<div class="section">
<h3><a name="a.E9.97.AE.E9.A2.98.E5.85.AD.EF.BC.9AYARN_.E5.90.AF.E5.8A.A8.E5.AE.B9.E5.99.A8.E5.A4.B1.E8.B4.A5"></a>&#x95ee;&#x9898;&#x516d;&#xff1a;YARN &#x542f;&#x52a8;&#x5bb9;&#x5668;&#x5931;&#x8d25;</h3>
<p>&#x5982;&#x679c;&#x4f60;&#x521b;&#x5efa;&#x7684;&#x5bb9;&#x5668;&#x6570;&#xff08;PS+Work&gt;GPU&#x663e;&#x5361;&#x603b;&#x6570;&#xff09;&#xff0c;&#x53ef;&#x80fd;&#x4f1a;&#x51fa;&#x73b0;&#x5bb9;&#x5668;&#x521b;&#x5efa;&#x5931;&#x8d25;&#xff0c;&#x90a3;&#x662f;&#x56e0;&#x4e3a;&#x5728;&#x4e00;&#x53f0;&#x670d;&#x52a1;&#x5668;&#x4e0a;&#x540c;&#x65f6;&#x521b;&#x5efa;&#x4e86;&#x8d85;&#x8fc7;&#x672c;&#x673a;&#x663e;&#x5361;&#x603b;&#x6570;&#x7684;&#x5bb9;&#x5668;&#x3002;</p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        &#169;            2008-2019
              Apache Software Foundation
            
                          - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a>.
        Apache Maven, Maven, Apache, the Apache feather logo, and the Apache Maven project logos are trademarks of The Apache Software Foundation.
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
